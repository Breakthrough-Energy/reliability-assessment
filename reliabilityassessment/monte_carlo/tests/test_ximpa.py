import numpy as np

from reliabilityassessment.monte_carlo.ximpa import ximpa


def test_ximpa():

    # NN = 5, the size of Z, ZB matrices (no need now in Python)
    NI, NJ = 2 - 1, 3 - 1  # be careful: 0-based index in Python
    ZIJ = 0.016667
    ZB = np.array(
        [
            [-0.011111, -0.008333, -0.005556, -0.002778, 0.000000],
            [-0.008333, -0.012500, -0.008333, -0.004167, 0.000000],
            [-0.005556, -0.008333, -0.011111, -0.005556, 0.000000],
            [-0.002778, -0.004167, -0.005556, -0.006944, 0.000000],
            [0.000000, 0.000000, 0.000000, 0.000000, 0.000000],
        ]
    )
    Z = ximpa(ZB, ZIJ, NI, NJ)

    Z_true = np.array(
        [
            [-0.010784, -0.007843, -0.005882, -0.002941, 0.000000],
            [-0.007843, -0.011765, -0.008824, -0.004412, 0.000000],
            [-0.005882, -0.008824, -0.010784, -0.005392, 0.000000],
            [-0.002941, -0.004412, -0.005392, -0.006863, 0.000000],
            [0.000000, 0.000000, 0.000000, 0.000000, 0.000000],
        ]
    )

    np.testing.assert_array_almost_equal(Z, Z_true)
